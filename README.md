# RAG System for Question Answering

## О проекте

Проект разработан в рамках хакатона "Альфа-Будущее" от Альфа-Банка. Цель проекта — создание интеллектуального pipeline RAG-системы (Retrieval-Augmented Generation), которая по пользовательскому запросу находит наиболее релевантные фрагменты в корпусе данных.

## Задача

Разработать pipeline RAG-системы, которая:
1. Принимает входной вопрос пользователя
2. Находит релевантные фрагменты в предоставленном корпусе данных
3. Возвращает топ-5 наиболее релевантных документов для каждого вопроса

## Архитектура RAG

Система работает по следующему принципу:

### 1. Индексирование
- Текстовые данные разбиваются на чанки (chunks)
- Для каждого чанка рассчитываются эмбеддинги
- Строится векторный индекс для эффективного поиска

### 2. Извлечение
- Для запроса генерируются эмбеддинги
- Выполняется поиск в векторном индексе
- Возвращаются ближайшие чанки
- Для повышения точности может использоваться переранжирование с cross-encoder

### 3. Промптинг
- Отобранные текстовые фрагменты передаются в языковую модель
- Модель получает инструкцию использовать только данные из контекста

### 4. Генерация
- Языковая модель формирует финальный ответ
- Сохраняется необходимый стиль и добавляются ссылки на источники

## Данные

Для работы системы используются два основных файла:

### 1. Questions.csv
- `q_id` — уникальный идентификатор вопроса
- `query` — текст вопроса пользователя

### 2. Websites.csv
- `web_id` — уникальный идентификатор веб-страницы
- `url` — адрес веб-страницы
- `kind` — тип импортированных данных
- `title` — заголовок страницы
- `text` — спарсенный текст со страницы

## Метрика качества

Основная метрика оценки — **Hit@5**:
- Показывает, у какой доли вопросов среди первых 5 найденных результатов присутствует хотя бы один релевантный элемент
- Формула: `Hit@5 = (1/|Q|) * Σ hit@5(q)`, где Q — вопросы с релевантными страницами
- Целевое значение: максимальное приближение к 1.0

## Технические требования

- Язык программирования: Python 3.10+
- Разрешается использовать только OpenSource библиотеки
- Запрещены закрытые библиотеки, частные API и неподходящий код

## Структура решения
```
project/
├── configs/
│ └── default.yaml # Конфигурационные файлы
├── data/
│ ├── processed/ # Обработанные данные
│ │ ├── .gitkeep
│ │ ├── chunker.log
│ │ ├── chunks.csv
│ │ └── chunks.jsonl
│ └── raw/ # Исходные данные
│ ├── questions_clean.csv
│ ├── websites_updated.csv
│ └── websites_updated.xlsx
├── submissions/ # Результаты для отправки
│ └── sample_submission.csv
├── docker/ # Docker конфигурации
│ ├── Dockerfile
│ └── docker-compose.yml
├── src/ # Исходный код
│ ├── api/ # API приложение
│ │ └── app.py
│ ├── embedding/ # Модуль эмбеддингов
│ │ └── embedder.py
│ ├── generator/ # Генерация ответов
│ │ ├── generate.py
│ │ └── prompt_templates.py
│ ├── preprocessing/ # Предобработка данных
│ │ ├── chunker.ipynb
│ │ ├── chunker.py
│ │ ├── clean.py
│ │ ├── noise_patterns.json
│ │ ├── read_xlsx.py
│ │ └── reranker/ # Переранжирование
│ │ ├── chunks_5_csv/
│ │ ├── cross_encoder.py
│ │ ├── re_rank.py
│ │ ├── rerank_hit5_1.ipynb
│ │ └── websites_to_reranker.ipynb
│ └── retriever/ # Поисковый модуль
│ └── indexer.py
├── .gitignore
├── Makefile # Автоматизация задач
├── README.md # Документация
├── repo-format.txt
└── requirements.txt # Зависимости
```

## Архитектура RAG системы

### 1. Предобработка данных (`src/preprocessing/`)
- **chunker.py** - разбиение текстов на чанки
- **clean.py** - очистка и нормализация данных
- **read_xlsx.py** - чтение данных из Excel файлов

### 2. Векторное представление (`src/embedding/`)
- **embedder.py** - генерация эмбеддингов для текстов

### 3. Поисковый модуль (`src/retriever/`)
- **indexer.py** - создание и работа с векторным индексом

### 4. Переранжирование (`src/preprocessing/reranker/`)
- **cross_encoder.py** - кросс-энкодер для точного ранжирования
- **re_rank.py** - логика переранжирования результатов

### 5. Генерация ответов (`src/generator/`)
- **generate.py** - генерация финальных ответов
- **prompt_templates.py** - шаблоны промптов для LLM

### 6. API слой (`src/api/`)
- **app.py** - веб-интерфейс для работы с системой

## Быстрый старт

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Предобработка данных
```bash
python src/preprocessing/chunker.py
python src/preprocessing/clean.py
```

### Генерация эмбеддингов
```bash
python src/embedding/embedder.py
```

### Создание векторного индекса
```bash
python src/retriever/indexer.py
```

### Запуск API
```bash
python src/api/app.py
```

### Использование Docker
```bash
docker-compose up --build
```

### Конфигурация
Основные настройки системы находятся в configs/default.yaml

## Данные

### Входные данные (data/raw/)

- questions_clean.csv - очищенные вопросы пользователей

- websites_updated.csv - обновленная база знаний веб-страниц

### Промежуточные данные (data/processed/)
- chunks.csv - разбитые на чанки тексты

- chunks.jsonl - чанки в формате JSONL

### Метрика качества

Основная метрика оценки — Hit@5:

- Показывает, у какой доли вопросов среди первых 5 найденных результатов присутствует хотя бы один релевантный элемент

- Целевое значение: максимальное приближение к 1.0

### Результаты
Файлы для отправки на платформу сохраняются в папке submissions/

### Технические требования
- Python 3.10+

- Только OpenSource библиотеки

- Запрещены закрытые API и неподходящий код

||||||||||| Разработано для хакатона "Альфа-Будущее" в сотрудничестве с Альфа-Банком
